{% extends "base.html" %}
{% load static customtags crispy_forms_tags %}

{% block extra_head %}
<link rel="stylesheet" href="{% static 'css/toast.min.css' %}">
<link rel="stylesheet"
      href="//cdn.jsdelivr.net/gh/highlightjs/cdn-release@10.1.2/build/styles/dracula.min.css">
{% endblock %}

{% block home_banner %} {% endblock %}

{% block content %}
<div class="container oc-screen newblog-container">
  <div class="row">
    <div class="col-md-8 mx-auto">
      <h1 class="text-center">New Blog Post</h1>
      <form method="post" name="newBlogForm" id="newBlogForm" enctype="multipart/form-data">
        {% csrf_token %}
        {{new_blog_form.media}}
        <fieldset>
          <!-- <legend>Legend</legend> -->
          <div class="form-group">
            {{ new_blog_form.blog_title|as_crispy_field }}
          </div>
          <div class="form-group">
            {{ new_blog_form.blog_subtitle|as_crispy_field }}
          </div>
          <div class="form-group">
            {{ new_blog_form.banner_image|as_crispy_field }}
          </div>
          <div class="form-group">
            {{ new_blog_form.banner_image_source|as_crispy_field }}
            <small id="banner_image_source_help" class="form-text text-muted">Please mention credits for banner image you are using if it is licensed.</small>
          </div>
          <div class="form-group">
            {{ new_blog_form.content|as_crispy_field }}
          </div>

          <input type="hidden" name="type" id="type" value="">

          <div class="form-group">
            {{ new_blog_form.blog_category|as_crispy_field }}
          </div>

          <div class="form-group">
            {{ new_blog_form.blog_tags|as_crispy_field }}
          </div>
          <div class="col-* write-blog-footer">
            <button type="button" class="btn btn-warning" id="previewBlog"><i class="fa fa-eye"></i> Preview</a>
            <!-- <button type="button" class="btn btn-primary" id="draftBtn">Save as Draft</button> -->
            <!-- <button type="submit" class="btn btn-success submitForModeration"><i class="fa fa-exchange"></i> Submit For Moderation</button> -->
          </div>
        </fieldset>
      </form>
    </div>
  </div>
</div>


{% endblock %}

{% block extra_js %}
<script type="text/javascript">
  var preview = false;
  var saveAsDraft = false;
  var submitForModeration = false;

  function blogSubmit(event) {
    var data = new FormData(this);
    console.log(data);

    $.ajax({
      url: "{% url 'blog:write_blog' %}",
      type: "POST",
      data: data,
      dataType: "json",
      success: function(result) {
        console.log("Success");
      },
      error: function(error) {
        console.log(error);
      }
    });
  }

  $("#previewBlog").on("click", function(event) {
    event.preventDefault();

    $("#newBlogForm").attr("action", "{% url 'blog:write_blog' %}");
    $("#newBlogForm #type").val("preview");
    $("#newBlogForm").submit();
  });

  // $("#draftBtn").on("click", function() {
  //   event.preventDefault();
  //
  //   $("#newBlogForm").attr("action", "{% url 'blog:write_blog' %}");
  //   $("#newBlogForm #type").val("draft");
  //   $("#newBlogForm").submit();
  // });

  $(".submitForModeration").on("click", function() {
    event.preventDefault();

    $("#newBlogForm").attr("action", "{% url 'blog:write_blog' %}");
    $("#newBlogForm #type").val("submitForModeration");
    $("#newBlogForm").submit();
  });
</script>
{% endblock %}
